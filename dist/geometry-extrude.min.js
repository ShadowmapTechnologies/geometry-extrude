!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).geometryExtrude={})}(this,function(e){"use strict";var t={exports:{}};function n(e,t,n){n=n||2;var r,i,o,a,l,v,u,f=t&&t.length,h=f?t[0]*n:e.length,s=p(e,0,h,n,!0),x=[];if(!s||s.next===s.prev)return x;if(f&&(s=function(e,t,n,r){var i,o,a,l,v,u=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,l=i<o-1?t[i+1]*r:e.length,(v=p(e,a,l,r,!1))===v.next&&(v.steiner=!0),u.push(m(v));for(u.sort(d),i=0;i<u.length;i++)n=y(u[i],n);return n}(e,t,s,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var c=n;c<h;c+=n)(l=e[c])<r&&(r=l),(v=e[c+1])<i&&(i=v),o<l&&(o=l),a<v&&(a=v);u=0!==(u=Math.max(o-r,a-i))?32767/u:0}return g(s,x,n,r,i,u,0),x}function p(e,t,n,r,i){var o,a;if(i===0<A(e,t,n,r))for(o=t;o<n;o+=r)a=l(o,e[o],e[o+1],a);else for(o=n-r;t<=o;o-=r)a=l(o,e[o],e[o+1],a);return a&&M(a,a.next)&&(O(a),a=a.next),a}function h(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!M(r,r.next)&&0!==S(r.prev,r,r.next))r=r.next;else{if(O(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function g(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;for(;0===i.z&&(i.z=b(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,l,v,u=1;do{for(n=e,o=e=null,a=0;n;){for(a++,r=n,t=l=0;t<u&&(l++,r=r.nextZ);t++);for(v=u;0<l||0<v&&r;)0!==l&&(0===v||!r||n.z<=r.z)?(n=(i=n).nextZ,l--):(r=(i=r).nextZ,v--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(1<a)}(i)}(e,r,i,o);for(var l,v,u=e;e.prev!==e.next;)if(l=e.prev,v=e.next,o?s(e,r,i,o):f(e))t.push(l.i/n|0),t.push(e.i/n|0),t.push(v.i/n|0),O(e),e=v.next,u=v.next;else if((e=v)===u){a?1===a?g(e=x(h(e),t,n),t,n,r,i,o,2):2===a&&c(e,t,n,r,i,o):g(h(e),t,n,r,i,o,1);break}}}function f(e){var t=e.prev,n=e,r=e.next;if(0<=S(t,n,r))return!1;for(var i=t.x,o=n.x,a=r.x,l=t.y,v=n.y,u=r.y,f=i<o?i<a?i:a:o<a?o:a,h=l<v?l<u?l:u:v<u?v:u,s=o<i?a<i?i:a:a<o?o:a,x=v<l?u<l?l:u:u<v?v:u,c=r.next;c!==t;){if(c.x>=f&&c.x<=s&&c.y>=h&&c.y<=x&&w(i,l,o,v,a,u,c.x,c.y)&&0<=S(c.prev,c,c.next))return!1;c=c.next}return!0}function s(e,t,n,r){var i=e.prev,o=e,a=e.next;if(0<=S(i,o,a))return!1;for(var l=i.x,v=o.x,u=a.x,f=i.y,h=o.y,s=a.y,x=l<v?l<u?l:u:v<u?v:u,c=f<h?f<s?f:s:h<s?h:s,p=v<l?u<l?l:u:u<v?v:u,g=h<f?s<f?f:s:s<h?h:s,d=b(x,c,t,n,r),y=b(p,g,t,n,r),m=e.prevZ,M=e.nextZ;m&&m.z>=d&&M&&M.z<=y;){if(m.x>=x&&m.x<=p&&m.y>=c&&m.y<=g&&m!==i&&m!==a&&w(l,f,v,h,u,s,m.x,m.y)&&0<=S(m.prev,m,m.next))return!1;if(m=m.prevZ,M.x>=x&&M.x<=p&&M.y>=c&&M.y<=g&&M!==i&&M!==a&&w(l,f,v,h,u,s,M.x,M.y)&&0<=S(M.prev,M,M.next))return!1;M=M.nextZ}for(;m&&m.z>=d;){if(m.x>=x&&m.x<=p&&m.y>=c&&m.y<=g&&m!==i&&m!==a&&w(l,f,v,h,u,s,m.x,m.y)&&0<=S(m.prev,m,m.next))return!1;m=m.prevZ}for(;M&&M.z<=y;){if(M.x>=x&&M.x<=p&&M.y>=c&&M.y<=g&&M!==i&&M!==a&&w(l,f,v,h,u,s,M.x,M.y)&&0<=S(M.prev,M,M.next))return!1;M=M.nextZ}return!0}function x(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!M(i,o)&&Z(i,r,r.next,o)&&z(i,o)&&z(o,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(o.i/n|0),O(r),O(r.next),r=e=o),r=r.next}while(r!==e);return h(r)}function c(e,t,n,r,i,o){var a,l,v=e;do{for(var u=v.next.next;u!==v.prev;){if(v.i!==u.i&&(l=u,(a=v).next.i!==l.i&&a.prev.i!==l.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Z(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(a,l)&&(z(a,l)&&z(l,a)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(a,l)&&(S(a.prev,a,l.prev)||S(a,l.prev,l))||M(a,l)&&0<S(a.prev,a,a.next)&&0<S(l.prev,l,l.next)))){var f=R(v,u);return v=h(v,v.next),f=h(f,f.next),g(v,t,n,r,i,o,0),void g(f,t,n,r,i,o,0)}u=u.next}v=v.next}while(v!==e)}function d(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var l=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(l<=i&&a<l&&(a=l,n=r.x<r.next.x?r:r.next,l===i))return n}r=r.next}while(r!==t);if(!n)return null;var v,u=n,f=n.x,h=n.y,s=1/0;r=n;for(;i>=r.x&&r.x>=f&&i!==r.x&&w(o<h?i:a,o,f,h,o<h?a:i,o,r.x,r.y)&&(v=Math.abs(o-r.y)/(i-r.x),z(r,e)&&(v<s||v===s&&(r.x>n.x||r.x===n.x&&(c=r,S((x=n).prev,x,c.prev)<0&&S(c.next,x,x.next)<0)))&&(n=r,s=v)),r=r.next,r!==u;);var x,c;return n}(e,t);if(!n)return t;var r=R(n,e);return h(r,r.next),h(n,n.next)}function b(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e){for(var t=e,n=e;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),(t=t.next)!==e;);return n}function w(e,t,n,r,i,o,a,l){return(e-a)*(o-l)<=(i-a)*(t-l)&&(n-a)*(t-l)<=(e-a)*(r-l)&&(i-a)*(r-l)<=(n-a)*(o-l)}function S(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function M(e,t){return e.x===t.x&&e.y===t.y}function Z(e,t,n,r){var i=u(S(e,t,n)),o=u(S(e,t,r)),a=u(S(n,r,e)),l=u(S(n,r,t));return i!==o&&a!==l||(!(0!==i||!v(e,n,t))||(!(0!==o||!v(e,r,t))||(!(0!==a||!v(n,e,r))||!(0!==l||!v(n,t,r)))))}function v(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function u(e){return 0<e?1:e<0?-1:0}function z(e,t){return S(e.prev,e,e.next)<0?0<=S(e,t,e.next)&&0<=S(e,e.prev,t):S(e,t,e.prev)<0||S(e,e.next,t)<0}function R(e,t){var n=new a(e.i,e.x,e.y),r=new a(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(n.next=i).prev=n,(r.next=n).prev=r,(o.next=r).prev=o,r}function l(e,t,n,r){var i=new a(e,t,n);return r?(i.next=r.next,(i.prev=r).next.prev=i,r.next=i):(i.prev=i).next=i,i}function O(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function a(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}t.exports=n,(t.exports.default=n).deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(A(e,0,o,n));if(i)for(var l=0,v=t.length;l<v;l++){var u=t[l]*n,f=l<v-1?t[l+1]*n:e.length;a-=Math.abs(A(e,u,f,n))}var h=0;for(l=0;l<r.length;l+=3){var s=r[l]*n,x=r[l+1]*n,c=r[l+2]*n;h+=Math.abs((e[s]-e[c])*(e[x+1]-e[s+1])-(e[s]-e[x])*(e[c+1]-e[s+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},n.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);0<i&&(r+=e[i-1].length,n.holes.push(r))}return n};var q=t.exports;function P(e,t,n){var r=t[0],i=t[1],o=n[0]-r,a=n[1]-i;if(0!==o||0!==a){var l=((e[0]-r)*o+(e[1]-i)*a)/(o*o+a*a);1<l?(r=n[0],i=n[1]):0<l&&(r+=o*l,i+=a*l)}return(o=e[0]-r)*o+(a=e[1]-i)*a}function i(e,t){var n=e.length-1,r=[e[0]];return function e(t,n,r,i,o){for(var a,l=i,v=n+1;v<r;v++){var u=P(t[v],t[n],t[r]);l<u&&(a=v,l=u)}i<l&&(1<a-n&&e(t,n,a,i,o),o.push(t[a]),1<r-a&&e(t,a,r,i,o))}(e,0,n,t,r),r.push(e[n]),r}function B(e,t,n){if(e.length<=2)return e;var r=void 0!==t?t*t:1;return e=i(e=n?e:function(e,t){for(var n,r,i,o,a,l=e[0],v=[l],u=1,f=e.length;u<f;u++)n=e[u],i=l,o=(r=n)[0]-i[0],a=r[1]-i[1],t<o*o+a*a&&(v.push(n),l=n);return l!==n&&v.push(n),v}(e,r),r)}function X(e,t){return e[0]*t[0]+e[1]*t[1]}function Y(e,t){var n=t[0],r=t[1],i=Math.sqrt(n*n+r*r);return e[0]=n/i,e[1]=r/i,e}function F(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function j(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}var L=[];function ce(e,t,n,r){var i,o,a,l,v,u,f,h,s,x,c,p=(o=n,(i=t)[0]*o[0]+i[1]*o[1]+i[2]*o[2]),g=Math.acos(p)*r;return F(L,n,t,-p),v=(l=a=L)[0],u=l[1],f=l[2],h=Math.sqrt(v*v+u*u+f*f),a[0]=v/h,a[1]=u/h,a[2]=f/h,s=e,x=t,c=Math.cos(g),s[0]=x[0]*c,s[1]=x[1]*c,s[2]=x[2]*c,F(e,e,L,Math.sin(g)),e}function V(e,t,n){if(n-t<3)return 0;for(var r=0,i=2*(n-1),o=2*t;o<2*n;){var a=e[i],l=e[i+1],v=e[o],u=e[o+1];i=o,o+=2,r+=a*u-v*l}return r}function k(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2;return q(e,t,n)}var $=[],ee=[],te=[];function T(e,t,n,r,i,o,a,l,v){var u,f,h,s=null!=a,x=i,c=null;s&&(c=new Uint32Array(r-n));for(var p,g,d,y,m,M,b,w,S,Z,z,R,O,A,q=[],P=n;P<r;P++){var B=P===r-1?n:P+1,F=P===n?r-1:P-1,j=e[2*F],L=e[2*F+1],V=e[2*P],k=e[2*P+1],T=e[2*B],U=e[2*B+1];$[0]=V-j,$[1]=k-L,ee[0]=T-V,ee[1]=U-k,Y($,$),Y(ee,ee),s&&(c[P]=x);var W=!1,E=void 0,I=void 0;if(l||P!==n)if(l||P!==r-1){O=ee,A=$,(R=te)[0]=O[0]+A[0],R[1]=O[1]+A[1];var _=te[1];te[1]=-te[0],te[0]=_,Y(te,te);var D=X(te,ee),G=Math.sqrt(1-D*D),J=o*Math.min(10,1/G);if(s&&a<1/G&&o*D<0){var N=V+te[0]*o,C=k+te[1]*o,H=Math.acos(G)/2,K=Math.tan(H)*Math.abs(o);t[2*x]=N+te[1]*K,t[2*x+1]=C-te[0]*K,t[2*++x]=N-te[1]*K,t[2*x+1]=C+te[0]*K,x++}else E=V+te[0]*J,I=k+te[1]*J,W=!0;if(W){if(v&&null!=u){var Q=(void(w=0),z=((S=E-(m=V))*((g=L)-(M=k))-(Z=I-M)*((p=j)-m))/(Z*((d=u)-p)-S*((y=f)-g)),(b=q)&&(b[w=w||0]=p+z*(d-p),b[w+1]=g+z*(y-g)),z);-.01<=Q&&Q<=1.01&&(t[2*h]=E=q[0],t[2*h+1]=I=q[1])}u=t[2*x]=E,f=t[2*x+1]=I,h=x,x++}}else te[0]=$[1],te[1]=-$[0],Y(te,te),E=V+te[0]*o,I=k+te[1]*o,W=!0;else te[0]=ee[1],te[1]=-ee[0],Y(te,te),u=t[2*x]=V+te[0]*o,f=t[2*x+1]=k+te[1]*o,h=x,x++}return c}function U(e,t,n,r,i){var o=null!=r?[]:new Float32Array(e.length);if(T(e,o,0,t&&t.length?t[0]:e.length/2,0,n,r,i,!0),t)for(var a=0;a<t.length;a++){var l=t[a];T(e,o,l,t[a+1]||e.length/2,null!=r?o.length/2:l,n,r,i,!1)}return o}function W(e,t,n,r){for(var i=0;i<Math.floor((r-n)/2);i++)for(var o=0;o<t;o++){var a=(i+n)*t+o,l=(r-i-1)*t+o,v=e[a];e[a]=e[l],e[l]=v}return e}function E(e,t){var n=e.length/2,r=0,i=t&&t.length?t[0]:n;0<V(e,r,i)&&W(e,2,r,i);for(var o=1;o<(t?t.length:0)+1;o++)V(e,r=t[o-1],i=t[o]||n)<0&&W(e,2,r,i)}function I(e){e.depth=e.depth||1,e.elevation=e.elevation||0,e.bevelSize=e.bevelSize||0,e.bevelSegments=null==e.bevelSegments?2:e.bevelSegments,e.smoothBevel=e.smoothBevel||!1,e.simplify=e.simplify||0,null==e.smoothSide&&(e.smoothSide="auto"),null==e.smoothSideThreshold&&(e.smoothSideThreshold=.9),"number"==typeof e.depth&&(e.bevelSize=Math.min(0<e.bevelSegments?e.bevelSize:0,e.depth/2)),0<e.bevelSize||(e.bevelSegments=0),e.bevelSegments=Math.round(e.bevelSegments);var t=e.boundingRect;if(e.translate=e.translate||[0,0],e.scale=e.scale||[1,1],e.fitRect){var n=null==e.fitRect.x?t.x||0:e.fitRect.x,r=null==e.fitRect.y?t.y||0:e.fitRect.y,i=e.fitRect.width,o=e.fitRect.height;null==i?null!=o?i=o/t.height*t.width:(i=t.width,o=t.height):null==o&&(o=i/t.width*t.height),e.scale=[i/t.width,o/t.height],e.translate=[(n-t.x)*e.scale[0],(r-t.y)*e.scale[1]]}}var pe=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];function _(e,t,n,r,i,o){var a=t.vertices,l=t.topVertices,v=t.splittedMap,u=t.depth,f=t.rect,h=t.elevation,s=t.levels,x=t.levelOffset,c=r-n,p=o.smoothBevel?1:2,g=Math.min(u/2,o.bevelSize),d=o.bevelSegments,y=i.vertex,m=Math.max(f.width,f.height,u),M=v?function(e){var t=(e+1)%c;return v[e+n]===v[t+n]}:function(e){return!1};if(0<g)for(var b=[0,0,1],w=[],S=[0,0,-1],Z=[],z=0,R=new Float32Array(c),O=0;O<2;O++)for(var A=0===O?u-g:g,q=0;q<=d*p;q++){for(var P=0,B=void 0,F=void 0,j=0;j<c;j++){var L=2*(j%c+n),V=v?2*v[L/2]:L;w[0]=a[L]-l[V],w[1]=a[L+1]-l[V+1],w[2]=0;var k=Math.sqrt(w[0]*w[0]+w[1]*w[1]);w[0]/=k,w[1]/=k;var T=(Math.floor(q/p)+q%p)/d;0===O?ce(Z,b,w,T):ce(Z,w,S,T);var U=0===O?T:1-T,W=g*Math.sin(U*Math.PI/2),E=k*Math.cos(U*Math.PI/2),I=g*k/Math.sqrt(W*W+E*E),_=Z[0]*I+l[V],D=Z[1]*I+l[V+1],G=Z[2]*I+A;if(e.position[3*i.vertex]=_,e.position[3*i.vertex+1]=D,e.position[3*i.vertex+2]=G+h,0<j&&(P+=Math.sqrt((B-_)*(B-_)+(F-D)*(F-D))),0<q||0<O){var J=3*(i.vertex-c),N=e.position[J],C=e.position[J+1],H=e.position[J+2];R[j]+=Math.sqrt((N-_)*(N-_)+(C-D)*(C-D)+(H-G)*(H-G))}if(e.uv[2*i.vertex]=P/m,e.uv[2*i.vertex+1]=R[j]/m,B=_,F=D,i.vertex++,!M(j)&&(1<p&&q%p||1===p&&1<=q))for(var K=0;K<6;K++){var Q=(pe[K][0]+j)%c,X=pe[K][1]+z;e.indices[i.index++]=(X-1)*c+Q+y}}z++}else for(var Y=0;Y<2;Y++)for(var $=0===Y?u:0,ee=0,te=void 0,ne=void 0,re=0;re<c;re++){var ie=2*(re+n),oe=a[ie],ae=a[ie+1],le=3*i.vertex,ve=2*i.vertex;e.position[le]=oe,e.position[le+1]=ae,e.position[le+2]=$+h,0<re&&(ee+=Math.sqrt((te-oe)*(te-oe)+(ne-ae)*(ne-ae))),e.uv[ve]=ee,e.uv[ve+1]=0===Y?s:x,te=oe,ne=ae,i.vertex++}for(var ue=0<g?d*p+1:1,fe=0;fe<c;fe++)if(!M(fe))for(var he=0;he<6;he++){var se=(pe[he][0]+fe)%c,xe=pe[he][1]+ue;e.indices[i.index++]=(xe-1)*c+se+y}}function D(e,t,n,r){var i=e.indices,o=e.topVertices,a=e.rect,l=e.depth,v=e.elevation;if(!(o.length<=4)){for(var u=n.vertex,f=i.length,h=0;h<f;h++)t.indices[n.index++]=u+i[h];Math.max(a.width,a.height);for(var s=0;s<(r.excludeBottom?1:2);s++)for(var x=0;x<o.length;x+=2){var c=o[x],p=o[x+1],g=3*n.vertex,d=2*n.vertex;t.position[g]=c,t.position[g+1]=p,t.position[g+2]=(1-s)*l+v,t.uv[d]=.5,t.uv[d+1]=.5,n.vertex++}if(!r.excludeBottom)for(var y=o.length/2,m=0;m<f;m+=3)for(var M=0;M<3;M++)t.indices[n.index++]=u+y+i[m+2-M]}}function G(e,t,n,r){var i=null==n||"auto"===n;if(!0===n)return{vertices:e,holes:t};for(var o=[],a=t&&[],l=e.length/2,v=[],u=[],f=[],h=0,s=0,x=(t?t.length:0)+1,c=0;c<x;c++){0===c?s=t&&t.length?t[0]:l:(h=t[c-1],s=t[c]||l);for(var p=h;p<s;p++){var g=e[2*p],d=e[2*p+1],y=p===s-1?h:p+1,m=e[2*y],M=e[2*y+1];if(i){var b=p===h?s-1:p-1,w=e[2*b],S=e[2*b+1];v[0]=w-g,v[1]=S-d,u[0]=m-g,u[1]=M-d,Y(v,v),Y(u,u),r<1-(.5*X(v,u)+.5)?(o.push(g,d),f.push(p)):(o.push(g,d,g,d),f.push(p,p))}else o.push(g,d,g,d),f.push(p,p)}c<x-1&&a&&a.push(o.length/2)}return{vertices:new Float32Array(o),splittedMap:f,holes:a}}function J(e,t){for(var n=0,r=0,i=0;i<e.length;i++){var o=e[i],a=o.indices,l=o.vertices,v=o.splittedMap,u=o.topVertices,f=o.holes,h=o.depth,s=0<Math.min(h/2,t.bevelSize)?t.bevelSegments:0;f=f||[],n+=a.length*(t.excludeBottom?1:2),r+=u.length/2*(t.excludeBottom?1:2);for(var x=2+2*s,c=0,p=0,g=0;g<f.length+1;g++){0===g?p=f.length?f[0]:l.length/2:(c=f[g-1],p=f[g]||l.length/2),n+=6*((v?v[p-1]+1:p)-(v?v[c]:c))*(x-1);var d=p-c;r+=d*x+(t.smoothBevel?0:s*d*2)}}for(var y={position:new Float32Array(3*r),indices:new(65535<r?Uint32Array:Uint16Array)(n),uv:new Float32Array(2*r)},m={vertex:0,index:0},M=0;M<e.length;M++)D(e[M],y,m,t);for(var b=0;b<e.length;b++){var w=e[b],S=w.holes,Z=w.vertices.length/2,z=0,R=S&&S.length?S[0]:Z;if(_(y,e[b],z,R,m,t),S)for(var O=0;O<S.length;O++)z=S[O],R=S[O+1]||Z,_(y,e[b],z,R,m,t)}return y.normal=function(e,t){function n(e,t,n,r){e[0]=t,e[1]=n,e[2]=r}for(var r,i,o,a,l,v,u,f,h,s,x,c,p,g,d,y=[],m=[],M=[],b=[],w=[],S=[],Z=e.length,z=new Float32Array(t.length),R=0;R<Z;){var O=3*e[R++],A=3*e[R++],q=3*e[R++];n(y,t[O],t[O+1],t[O+2]),n(m,t[A],t[A+1],t[A+2]),n(M,t[q],t[q+1],t[q+2]),j(b,y,m),j(w,m,M),r=S,o=w,a=(i=b)[0],l=i[1],v=i[2],u=o[0],f=o[1],h=o[2],r[0]=l*h-v*f,r[1]=v*u-a*h,r[2]=a*f-l*u;for(var P=0;P<3;P++)z[O+P]=z[O+P]+S[P],z[A+P]=z[A+P]+S[P],z[q+P]=z[q+P]+S[P]}for(var B=0;B<z.length;)n(S,z[B],z[B+1],z[B+2]),c=(x=s=S)[0],p=x[1],g=x[2],d=Math.sqrt(c*c+p*p+g*g),s[0]=c/d,s[1]=p/d,s[2]=g/d,z[B++]=S[0],z[B++]=S[1],z[B++]=S[2];return z}(y.indices,y.position),y.boundingRect=e[0]&&e[0].rect,y}function N(e,t,n){for(var r=n.lineWidth,i=e.length,o=new Float32Array(2*i),a=n.translate||[0,0],l=n.scale||[1,1],v=0,u=0;v<i;v++)o[u++]=e[v][0]*l[0]+a[0],o[u++]=e[v][1]*l[1]+a[1];V(o,0,i)<0&&W(o,2,0,i);var f=[],h=[],s=n.miterLimit,x=T(o,h,0,i,0,-r/2,s,!1,!0);W(o,2,0,i);for(var c=T(o,f,0,i,0,-r/2,s,!1,!0),p=(f.length+h.length)/2,g=new Float32Array(2*p),d=0,y=h.length/2,m=0;m<h.length;m++)g[d++]=h[m];for(var M=0;M<f.length;M++)g[d++]=f[M];for(var b=new(65535<p?Uint32Array:Uint16Array)(3*(2*(i-1)+(p-2*i))),w=0,S=0;S<i-1;S++){var Z=S+1;b[w++]=y-1-x[S],b[w++]=y-1-x[S]-1,b[w++]=c[S]+1+y,b[w++]=y-1-x[S],b[w++]=c[S]+1+y,b[w++]=c[S]+y,c[Z]-c[S]==2?(b[w++]=c[S]+2+y,b[w++]=c[S]+1+y,b[w++]=y-x[Z]-1):x[Z]-x[S]==2&&(b[w++]=c[Z]+y,b[w++]=y-1-(x[S]+1),b[w++]=y-1-(x[S]+2))}var z=0<n.bevelSize?U(g,[],n.bevelSize,null,!0):g,R=n.boundingRect;return{vertices:g,indices:b,topVertices:z,rect:{x:R.x*l[0]+a[0],y:R.y*l[1]+a[1],width:R.width*l[0],height:R.height*l[1]},depth:"function"==typeof n.depth?n.depth(t):n.depth,holes:[]}}function C(e,t){for(var n=[],r=0;r<e.length;r++){for(var i=e[r],o=[],a=i.length,l=i[a-1][0],v=i[a-1][1],u=0,f=0;f<a;f++){var h=i[f][0],s=i[f][1],x=h-l,c=s-v;t<(u+=Math.sqrt(x*x+c*c))&&(o.push(i[f]),u=0),l=h,v=s}3<=o.length&&n.push(o)}return 0<n.length?n:null}function H(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];3<=(i=B(i,t,!0)).length&&n.push(i)}return 0<n.length?n:null}function K(e,t){t=Object.assign({},t);for(var n=[1/0,1/0],r=[-1/0,-1/0],i=0;i<e.length;i++)ne(e[i][0],n,r);t.boundingRect=t.boundingRect||{x:n[0],y:n[1],width:r[0]-n[0],height:r[1]-n[1]},I(t);for(var o=[],a=t.translate||[0,0],l=t.scale||[1,1],v=t.boundingRect,u={x:v.x*l[0]+a[0],y:v.y*l[1]+a[1],width:v.width*l[0],height:v.height*l[1]},f=Math.min(v.width,v.height)/1e5,h=0;h<e.length;h++){var s=C(e[h],f);if(s){var x=t.simplify/Math.max(l[0],l[1]);if(0<x&&(s=H(s,x)),s){for(var c=q.flatten(s),p=c.vertices,g=c.holes,d=c.dimensions,y=0;y<p.length;)p[y]=p[y++]*l[0]+a[0],p[y]=p[y++]*l[1]+a[1];if(E(p,g),2!==d)throw new Error("Only 2D polygon points are supported");var m=0<t.bevelSize?U(p,g,t.bevelSize,null,!0):p,M=k(m,g,d),b=G(p,g,t.smoothSide,t.smoothSideThreshold);o.push({indices:M,vertices:b.vertices,rawVertices:p,topVertices:m,holes:b.holes,splittedMap:b.splittedMap,rect:u,depth:"function"==typeof t.depth?t.depth(h):t.depth,elevation:"function"==typeof t.elevation?t.elevation(h):t.elevation,levels:"function"==typeof t.levels?t.levels(h):t.levels,levelOffset:"function"==typeof t.levelOffset?t.levelOffset(h):t.levelOffset})}}}return J(o,t)}function Q(e,t){t=Object.assign({},t);for(var n=[1/0,1/0],r=[-1/0,-1/0],i=0;i<e.length;i++)ne(e[i],n,r);t.boundingRect=t.boundingRect||{x:n[0],y:n[1],width:r[0]-n[0],height:r[1]-n[1]},I(t);var o=t.scale||[1,1];null==t.lineWidth&&(t.lineWidth=1),null==t.miterLimit&&(t.miterLimit=2);for(var a=[],l=0;l<e.length;l++){var v=e[l],u=t.simplify/Math.max(o[0],o[1]);0<u&&(v=B(v,u,!0)),a.push(N(v,l,t))}return J(a,t)}function ne(e,t,n){for(var r=0;r<e.length;r++)t[0]=Math.min(e[r][0],t[0]),t[1]=Math.min(e[r][1],t[1]),n[0]=Math.max(e[r][0],n[0]),n[1]=Math.max(e[r][1],n[1])}e.extrudeGeoJSON=function(t,e){e=Object.assign({},e);var n=[],r=[],i=[],o=[],a=[1/0,1/0],l=[-1/0,-1/0];"LineString"!==t.type&&"MultiLineString"!==t.type&&"Polygon"!==t.type&&"MultiPolygon"!==t.type||(t={features:[{geometry:t}]});for(var v=0;v<t.features.length;v++){var u=t.features[v].geometry;if(u&&u.coordinates)switch(u.type){case"LineString":n.push(u.coordinates),i.push(v),ne(u.coordinates,a,l);break;case"MultiLineString":for(var f=0;f<u.coordinates.length;f++)n.push(u.coordinates[f]),i.push(v),ne(u.coordinates[f],a,l);break;case"Polygon":r.push(u.coordinates),o.push(v),ne(u.coordinates[0],a,l);break;case"MultiPolygon":for(var h=0;h<u.coordinates.length;h++)r.push(u.coordinates[h]),o.push(v),ne(u.coordinates[h][0],a,l)}}e.boundingRect=e.boundingRect||{x:a[0],y:a[1],width:l[0]-a[0],height:l[1]-a[1]};var s=e.depth,x=e.elevation,c=e.levels,p=e.levelOffset;return{polyline:Q(n,Object.assign(e,{depth:function(e){return"function"==typeof s?s(t.features[i[e]]):s}})),polygon:K(r,Object.assign(e,{depth:function(e){return"function"==typeof s?s(t.features[o[e]]):s},elevation:function(e){return"function"==typeof x?x(t.features[o[e]]):x},levels:function(e){return"function"==typeof c?c(t.features[o[e]]):c},levelOffset:function(e){return"function"==typeof p?p(t.features[o[e]]):p}}))}},e.extrudePolygon=K,e.extrudePolyline=Q,e.flatten=function(e){return q.flatten(e)},e.offsetPolygon=U,e.triangulate=k,Object.defineProperty(e,"__esModule",{value:!0})});
